name: Fetch Dollar Index

on:
  schedule:
    # 매일 한국시간 오전 9시 (UTC 0시)에 실행
    - cron: '0 0 * * *'
  workflow_dispatch: # 수동 실행 가능

jobs:
  fetch-dollar-index:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Fetch Dollar Index from API
        env:
          # Alpha Vantage API 키 (GitHub Secrets에 저장 필요)
          ALPHA_VANTAGE_API_KEY: ${{ secrets.ALPHA_VANTAGE_API_KEY }}
        run: |
          # Alpha Vantage API로 달러 지수(DX) 데이터 가져오기
          # 또는 FRED API 사용 가능
          if [ -z "$ALPHA_VANTAGE_API_KEY" ]; then
            echo "API 키가 설정되지 않았습니다. 샘플 데이터를 사용합니다."
            # 샘플 데이터 생성
            cat > public/data/dollar-index.json << EOF
          {
            "date": "$(date +%Y-%m-%d)",
            "current": 93.30,
            "history": [],
            "52week": {
              "low": 91.73,
              "high": 103.96,
              "average": 97.84
            }
          }
          EOF
          else
            # 실제 API 호출 (예시)
            curl -s "https://www.alphavantage.co/query?function=DX&interval=daily&apikey=$ALPHA_VANTAGE_API_KEY" > dollar-index-raw.json
            # JSON 파싱 및 변환 로직 필요
            # 여기서는 간단한 예시만 제공
          fi

      - name: Commit and push
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add public/data/dollar-index.json
          git diff --staged --quiet || git commit -m "Update dollar index data [skip ci]"
          git push

